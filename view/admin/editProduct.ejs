<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Page</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
  <!-- <script defer src="https://cdn.crop.guide/loader/l.js?c=FLMYXV"></script> -->
   <!-- crop guid -->
   <script defer src="https://cdn.crop.guide/loader/l.js?c=YBKHTF"></script>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<script>
    
</script>
<body>
  <div class="container mt-5" style="background-color:#d5e6d4">
    <h1 class="mb-4">Edit Product</h1>
    <form action="/admin/editProduct?prodId=<%=idEdit %>" method="POST" enctype="multipart/form-data">
   
      <p style="color: red; font-size: 21px;"><%=errmsg %></p>
      <div class="form-group">
        <label for="name">Product Name</label>
        <input type="text" class="form-control" id="name" value="<%=editData.name %>" name="name" placeholder="Enter product name">
      </div>
      <div class="form-group">
        <label for="productSelectCategory">Category:</label>
        <select id="productSelectCategory" name="category" class="form-control">
            <% cateData.forEach(element => { %>
                <option value="<%= element._id %>"><%= element.name %></option>
            <% }); %>
        </select>
        <small id="categoryError" class="form-text text-danger"></small>
    </div>
      <div class="form-group">
        <label for="price">Price</label>
        <input type="number" class="form-control" id="price" value="<%=editData.price %>" name="price" placeholder="Enter price">
      </div>
      <div class="form-group">
        <label for="quantity">Quantity</label>
        <input type="number" class="form-control" id="quantity" value="<%=editData.quantity %>" name="quantity" placeholder="Enter quantity">
      </div>
      <div class="form-group">
        <label for="quantity">Description</label>
        <input type="text" class="form-control" id="quantity" value="<%=editData.description %>" name="description" placeholder="Enter Description">
      </div>
      <div class="form-group">
        <% editData.images.forEach((img, index) => { %>
          <div class="image-wrapper" style="display: flex; align-items: center; margin-bottom: 10px;">
            <img src="<%= img.startsWith('http') ? img : ('/userImages/' + img) %>" alt="Image" style="width: 100px; margin-right: 10px;">
            
            <!-- Hidden input to keep track of existing images -->
            <input type="hidden" name="existingImages" value="<%= img %>">

            
            <!-- Delete button -->
            <button type="button" class="btn btn-danger delete-image-btn" data-image="<%= img %>" data-prod-id="<%= idEdit %>">
              Delete
            </button>
          </div>
          
          
          <% }) %>
        </div>
        
        <div class="form-group">
          <label for="productUploadImage">Images:</label>
          <input type="file" id="images" name="images" class="form-control" multiple>
          <small id="imageError" class="form-text text-danger"></small>
      </div>
      
      <button type="submit" class="btn " style="background-color: #4CAF50;">Save</button>
      <button type="button" class="btn btn-secondary" onclick="window.location.href='/products'">Cancel</button>
    </form>
  </div>
<style>

    body {
  background-color: #f8f9fa;
}

.container {
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h1 {
  font-size: 2rem;
  color: #333;
}
</style>
<script>
  document.querySelectorAll('.delete-image-btn').forEach(button => {
    button.addEventListener('click', function() {
      const image = this.getAttribute('data-image');
      const prodId = this.getAttribute('data-prod-id');

      // Confirm the deletion
      if (confirm('Are you sure you want to delete this image?')) {
        // Send delete request using Fetch API
        fetch(`/admin/deleteImage?prodId=${prodId}&image=${image}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Reload the page or remove the image from the UI
            window.location.reload();  // Optionally, remove the image without reloading the page
          } else {
            alert('Failed to delete the image');
          }
        })
        .catch(err => console.error('Error:', err));
      }
    });
  });
</script>
</body>
</html>